# パフォーマンスベンチマーク

このドキュメントでは、Zario と他の主要な Node.js ロギングライブラリとの詳細なパフォーマンス比較を紹介します。

## 概要

Zario は、高パフォーマンスなアプリケーション向けにゼロから設計されています。  
最適化されたシリアライズ、非ブロッキング非同期ログ処理、効率的なメタデータマージにより、一般的なロギングシナリオにおいて既存のライブラリを一貫して上回る性能を発揮します。

## テスト環境

ベンチマークは以下のハードウェア・ソフトウェア構成で実施しました。

- **OS**: Ubuntu 24.04（Linux 6.14.0-29-generic）
- **CPU**: Intel Core i3-8130U @ 2.20GHz（2コア / 4スレッド）
- **RAM**: 8GB DDR4
- **ランタイム**: Bun 1.3.6 / Node.js v24.13.0
- **出力先**: 純粋な CPU オーバーヘッド測定のため、すべて `/dev/null` へ出力

## 測定方法

正確かつ公平な結果を得るため、以下の方法で測定を行いました。

- **Null 出力**: すべてのトランスポートを `/dev/null` または no-op ストリームに設定し、I/O ボトルネックを排除
- **ウォームアップ**: JIT 最適化を促すためのウォームアップフェーズを実施
- **反復回数**: 統計的に有意な結果を得るため、数百万回以上の反復テストを実行
- **比較基準**: すべての比較は Zario の性能をベースラインとして評価

## 結果

### シンプルメッセージ
*テスト: `logger.info("Hello world")`*

| ライブラリ | ops/sec | ns/op | Zario比 |
|--------------|-----------|--------|-----------|
| **Zario** | **1,850,320** | **540** | **baseline** |
| Winston | 204,144 | 4,899 | 9倍遅い |
| Pino | 195,237 | 5,122 | 9.5倍遅い |
| Bunyan | 137,437 | 7,276 | 13倍遅い |
| Log4js | 96,451 | 10,368 | 19倍遅い |

### メタデータ付き
*テスト: `logger.info("msg", { user, action, ip })`*

| ライブラリ | ops/sec | ns/op |
|--------------|-----------|--------|
| **Zario** | **1,806,907** | **553** |
| Pino | 615,333 | 1,625 |
| Bunyan | 228,430 | 4,378 |
| Winston | 201,617 | 4,960 |
| Log4js | 32,881 | 30,413 |

### 子ロガー
*テスト: `child.info("Request handled")`*

| ライブラリ | ops/sec | ns/op |
|--------------|-----------|--------|
| **Zario** | **1,394,318** | **717** |
| Pino | 470,311 | 2,126 |
| Winston | 146,196 | 6,840 |
| Bunyan | 119,293 | 8,383 |

### フィルタリングされたログ
*テスト: レベルが `info` のとき `logger.debug`（スキップされる）*

| ライブラリ | ops/sec | ns/op |
|--------------|-----------|--------|
| Pino | 22,737,613 | 44 |
| Bunyan | 6,705,343 | 149 |
| **Zario** | **3,206,053** | **312** |
| Log4js | 1,943,461 | 515 |
| Winston | 436,322 | 2,292 |

### 深いネストのメタデータ
*テスト: 多段階にネストされたオブジェクトのログ出力*

| ライブラリ | ops/sec | ns/op |
|--------------|-----------|--------|
| **Zario** | **2,461,337** | **406** |
| Pino | 239,021 | 4,184 |
| Bunyan | 81,530 | 12,265 |
| Winston | 72,745 | 13,747 |
| Log4js | 15,381 | 65,015 |

### エラーログ
*テスト: `logger.error(new Error("Failure"))`*

| ライブラリ | ops/sec | ns/op |
|--------------|-----------|--------|
| **Zario** | **1,846,615** | **542** |
| Winston | 165,317 | 6,049 |
| Bunyan | 127,400 | 7,849 |
| Pino | 117,557 | 8,507 |
| Log4js | 38,538 | 25,948 |

### 高頻度バースト
*テスト: 100,000 件のログを一括処理*

| ライブラリ | 時間 (ms) | logs/sec |
|--------------|-------------|-------------|
| **Zario** | **26.58** | **3,762,563** |
| Pino | 129.09 | 774,661 |
| Winston | 426.08 | 234,698 |
| Bunyan | 694.01 | 144,089 |
| Log4js | 1033.30 | 96,777 |

## 分析と考察

- **総合性能**: Zario はシンプルログ、メタデータ付与、子ロガー、エラー処理など、実際のロギング処理全般で最速の結果を示しました。
- **子ロガー**: **Pino の約 3 倍、Winston の約 10 倍高速**。複雑なマイクロサービスでのリクエストトレーシングに最適です。
- **バースト処理**: 最適化された非同期パイプラインと最小限のオブジェクト生成により、**Pino の約 4.9 倍高速**。
- **フィルタリングログ**: このカテゴリでは Pino が最速ですが、Zario も毎秒 300 万件以上の高スループットを維持しています。
- **深いメタデータ処理**: ネストの深いオブジェクト処理において **Pino の 10 倍以上高速**。

## 注意事項

- 使用するトランスポート数やカスタムフィルター／エンリッチャーの複雑さによって性能は変動します。
- すべて標準設定で測定していますが、公平性のため各ライブラリの推奨最適化（例：Pino の `pino.destination`）は適用しています。
- 本ベンチマークは CPU オーバーヘッドに焦点を当てています。実運用ではディスクやネットワーク I/O がボトルネックになる場合があります。

---

[← Roadmap](./roadmap.md) | [Introduction →](./introduction.md)
